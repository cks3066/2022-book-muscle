# P359 ~ P 366

## 1. 실행 컨텍스트는 자바스크립트의 동작 원리를 담고 있는 핵심 개념이다

---

실행 컨텍스트의 학습을 통해 아래 내용을 설명할 수 있다면 완벽히 학습한 것!!

- 스코프를 기반으로 식별자와 식별자에 바인딩 된 값을 관리하는 방식
- 호이스팅이 발생하는 이유
- 클로저의 동작 방식
- 태스크 큐와 함께 동작하는 이벤트 핸들러
- 비동기 처리의 동작 방식

들을 알 수 있다.

<br>

## 2. 소스코드는 다음의 타입으로 구분된다.

---

- 전역 코드 : 전역에 존재하는 소스코드. 전역에 정의된 함수나 클래스의 내부 코드는 포함되지 않는다.

- 함수 코드 : 함수 내부에 존재하는 소스코드. 함수 내부에 중첩된 함수, 클래스 등의 내부 코드는 포함되지 않는다.

- eval 코드 : eval 함수에 인수로 전달되어 실행되는 소스코드

- 모듈 코드 : 모듈 내부에 존재하는 소스코드. 모듈 내부의 함수, 클래스 등의 내부 코드는 포함되지 않는다.

이 코드들은 각기 다른 `실행 컨텍스트의 생성, 관리 방법`을 갖는다.

<br>

## 3. 소스코드에 따른 실행 컨텍스트 생성 시기

---

- 전역 코드 : 전역 코드는 최상위 스코프인 전역 스코프를 생성한다. 전역 코드가 `평가`되면, 전역 실행 컨텍스트가 생성된다.

- 함수 코드 : 함수 코드는 지역 스코프를 생성한다. 함수 코드가 `평가`되면, 함수 실행 컨텍스트가 생성된다. **(이 때 생성되는 지역 스코프는 전역 스코프에서 시작하는 스코프 체인의 일원이 된다.)**

- eval 코드 : `strict mode` 에서 자신만의 독자적인 스코프를 생성. eval 코드가 `평가` 되면, eval 실행 컨텍스트가 생성된다.

- 모듈 코드 : 모듈별로 독립적인 모듈 스코프를 생성한다. 모듈 코드가 평가되면 모듈 실행 컨텍스트가 생성된다.

<br>

## 4. 소스코드의 평가는 무엇인가요 ?

---

자바스크립트의 모든 소스코드는 실행에 앞서 평가 과정을 거친다. (코드 실행을 위한 준비 단계) -> `평가`단계와 `실행`단계가 존재하는구나

이 평가 과정에서 다음의 일을 수행합니다.

1. 실행 컨텍스트를 생성

2. 변수 함수 등의 선언문을 먼저 실행하여 생성된 변수, 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프(렉시컬 환경의 환경 레코드)에 등록

평가 과정이 종료되면, `런타임`이 시작된다. (선언문을 제외한 소스코드가 순차적으로 `실행`된다) -> 런타임에서 참조하는 변수와 함수들은 실행컨텍스트의 스코프에 등록되어 있다.

<br>

## 5. 예시

---

```jsx
var x;

x = 1;
```

1. `평가` 과정에서 `var x;` 가 실행된다. 이 때 생성된 변수 식별자 `x`는 실행 컨텍스트가 관리하는 스코프에 등록되고, `undefined`로 초기화된다.

2. `실행` 과정에서는 `x=1;`만 실행된다. 이 때, 변수에 값을 할당하려면 먼저 `x` 변수의 선언 여부를 따져야한다.

3. 실행 컨텍스트가 관리하는 스코프에 `x` 변수가 등록되어 있는지를 확인한 후, 선언되어 있다면 할 일을 수행한다.

<br>

## 6. 실행 컨텍스트가 해야하는 일

1. 선언에 의해 생성된 모든 식별자를 `스코프를 구분`하여 등록하고, 지속적으로 관리해야한다.

2. 스코프는 중첩 관게에 의해 스코프 체인을 형성해야한다. 즉, 스포크 체인을 통해 상위 스코프로 이동하며 식별자를 검색할 수 있어야한다.

3. 현재 실행 중인 **코드의 실행 순서를 변경**(새로운 함수를 호출하여 생기는 변경)할 수 있어야하며, **다시 되돌아갈 수** 있어야한다. (함수 호출을 했다면, 함수 호출 라인 이 후 라인을 순차 실행해야하므로)

**👏 실행 컨텍스트는 소스코드를 실행하는데 필요한 환경을 제공하고, 코드의 실행 결과를 실제로 관리하는 영역이다. (모든 코드는 실행 컨텍스트를 통해 실행된다.)**

**👏 소스코드를 실행하는데 필요한 환경은 `렉시컬 환경`으로 관리하고, 코드 실행 순서의 관리는 `실행 컨텍스트 스택(이하 콜스택)`으로 관리한다.**

<br>

## 실행 컨텍스트 스택

다음 코드는 전역 코드와 함수 코드로 이루어져있다.

```jsx
const x = 1;

function foo() {
  const y = 2;

  function bar() {
    const z = 3;
    console.log(x + y + z);
  }
  bar();
}
foo(); // 6
```

### 1. 전역 코드의 평가 : 전역 코드를 평가하여 `전역 실행 컨텍스트`를 생성하고 실행 컨텍스트 스택에 푸시한다. (`x`, `foo`가 실행 컨텍스트에 등록)

<br>

### 2. 전역 코드의 실행 : `x`에 값이 할당되고, `foo` 함수가 호출

<br>

### 3. `foo` 함수 코드의 평가 : `foo`가 호출되면, 전역 코드의 실행은 중지되고 자바스크립트 엔진은 `foo` 함수 내부의 코드를 평가하여 `foo 함수 실행 컨텍스트`를 만든다. 이를 실행 컨텍스트 스택에 푸시한다. (`y`와 `bar`가 실행 컨텍스트에 등록)

<br>

### 4. `foo` 함수 코드의 실행 : `y`에 값이 할당되고, `bar`함수가 호출

<br>

### 5. `bar` 함수 코드의 실행 : `bar`가 호출되면, `foo` 코드의 실행은 중지되고 자바스크립트 엔진은 `bar` 함수 내부의 코드를 평가하여 `bar 함수 실행 컨텍스트`를 만든다. 이를 실행 컨텍스트 스택에 푸시한다. (`z`가 실행 컨텍스트에 등록)

<br>

### 6. `bar` 함수 코드의 실행 : `z`에 값이 할당되고, `console.log`함수를 호출, `bar` 함수가 종료된다.

<br>

### 7. `foo` 함수 코드로 복귀 : `bar 함수 실행 컨텍스트`를 실행 컨텍스트 스택에서 팝하여 제거한다. `foo` 함수도 더 이상 코드가 없으므로 종료된다.

<br>

### 8. 전역 코드로 복귀 : `foo 함수 실행 컨텍스트`를 팝하여 제거한다. 더 이상 실행할 코드가 없으므로 `전역 실행 컨텍스트`도 제거된다.

## 정리

---

- 스코프를 기반으로 식별자와 식별자에 바인딩 된 값을 관리하는 방식
- 호이스팅이 발생하는 이유 : 소스코드 평가 과정에서 변수 선언문, 함수 선언문이 먼저 처리되어 실행 컨텍스트가 관리하는 스코프(렉시컬 환경의 환경 레코드)에 등록된다.
- 클로저의 동작 방식
- 태스크 큐와 함께 동작하는 이벤트 핸들러
- 비동기 처리의 동작 방식
